# Claude Instructions for database-query-tool

## Development Workflow

**IMPORTANT: Always test in dev mode, never build for production during development.**

Running tests in production mode wastes time. Use:
```bash
# Start dev server in background
pnpm run dev &

# Run tests against dev server
pnpm run test
```

## Database Checkpoint System

The SQL database hook uses a 5-checkpoint system for initialization and query execution. At each checkpoint, we log the status and know the state of previous steps.

### Checkpoint Flow

```
Checkpoint 1: Module Loading
   ↓ (SQL constructor available)
Checkpoint 2: Database Creation
   ↓ (Database object instantiated)
Checkpoint 3: Seed Data Processing
   ↓ (Data unescaped and validated)
Checkpoint 4: Database Seeding
   ↓ (Tables created, data inserted)
Checkpoint 5: Query Execution (per query)
   ↓ (Results returned or error)
```

### Checkpoint States

| Checkpoint | State | Success Log | Failure Action |
|------------|-------|-------------|----------------|
| 1 | `module_loading` | `[DB:1/5] Module: LOADED` | Try next CDN |
| 2 | `db_creation` | `[DB:2/5] Database: CREATED` | Fail - memory error |
| 3 | `seed_processing` | `[DB:3/5] Seed: PROCESSED (N chars)` | Fail - invalid data |
| 4 | `db_seeding` | `[DB:4/5] Seeding: COMPLETE (N tables)` | Fail - SQL syntax error |
| 5 | `query_execution` | `[DB:5/5] Query: SUCCESS (N rows)` | Show error to user |

### Files Using Checkpoint System

- `hooks/use-sql-database.ts` - Main hook implementation
- `app/challenge/[id]/challenge-player.tsx` - Displays checkpoint status

### Debugging Query Issues

When query execution fails, the checkpoint system provides:
1. Previous checkpoint states (was DB created? seeded?)
2. Actual SQL string being executed
3. Full error message from SQL.js
4. Character-by-character analysis of problematic queries
